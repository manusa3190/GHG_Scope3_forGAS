<script>
const useUsers = defineStore('useUsers', () => {

  const 自所属users = ref([])

  const get自所属users= async()=> new Promise(async(resolve)=>{

    if(!localStorage.length){
      await fetch自所属users()
    }

    if(localStorage.length){

      自所属users.value = [...Array(localStorage.length)].map((_,i)=>{
          const key = localStorage.key(i)
          const item = JSON.parse(localStorage.getItem(key))
          return item
      })
      resolve()
    }else{

    }
  })

  const fetch自所属users=()=> new Promise((resolve)=>{
    google.script.run
      .withSuccessHandler(res=>{
        res.forEach(user=>{
          localStorage.setItem(user['メールアドレス'],JSON.stringify(user))
        })
        resolve()
      })
      .get自所属users()    
  })

  return {自所属users, get自所属users, fetch自所属users}
})
</script>