<script>
const useUsers = defineStore('useUsers', async() => {

  const get自所属users= async()=> new Promise(async(resolve)=>{

    if(!localStorage.length){
      await fetch自所属users()
    }

    if(localStorage.length){
      resolve(
        [...Array(localStorage.length)].map((_,i)=>{
          const key = localStorage.key(i)
          const item = JSON.parse(localStorage.getItem(key))
          return item
        })
      )
    }else{

    }
  })

  const fetch自所属users=()=> new Promise((resolve)=>{
    google.script.run
      .withSuccessHandler(res=>{
        res.forEach(user=>{
          localStorage.setItem(user['メールアドレス'],JSON.stringify(user))
        })
        resolve()
      })
      .get自所属users()    
  })

  const 自所属users = ref(await get自所属users())

  return {自所属users, fetch自所属users}
})
</script>