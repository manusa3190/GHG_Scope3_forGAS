<script>
const useTables = defineStore('useTables', () => {
  const 自所属原資材docs = ref({})
  const 使いまわし情報docs = ref({})
  
  const fetch自所属原資材docs=()=>new Promise((resolve)=>{
    google.script.run
      .withSuccessHandler(res=>{
        自所属原資材docs.value= structuredClone(res) //これをしとかないとuseFieldにセットした時に無限ループしてしまう
        resolve()
      })
      .withFailureHandler(err=>{
        console.log(113)
      })
      .get自所属原資材docs()
  })
        
  const fetch使いまわし情報docs=()=>new Promise((resolve)=>{
    google.script.run
      .withSuccessHandler(res=>{
        使いまわし情報docs.value=res
        resolve()
      })
      .get使いまわし情報docs()
  })


  const set原資材doc=(data)=>{
    google.script.run
      .withSuccessHandler(res=>{
        自所属原資材docs.value[res['品目コード']]=res
        resolve()
      })
      .set自所属原資材doc()
  }

  const set使いまわし情報doc=(data)=>{
      google.script.run
      .withSuccessHandler(res=>{
        使いまわし情報docs.value[res['構成コード']]=res
        resolve()
      })
      .set使いまわし情報doc()
  }

  const 自所属原資材items = computed(()=>Object.values(自所属原資材docs.value))

  return {自所属原資材docs, 自所属原資材items, 使いまわし情報docs, fetch自所属原資材docs, fetch使いまわし情報docs, set原資材doc, set使いまわし情報doc}
})
</script>