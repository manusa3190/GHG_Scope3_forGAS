<script lang="ts">
import { defineComponent,ref } from 'vue'
import { useField } from 'vee-validate'
import useMasters from '@/stores/useMasters';
import useState from '@/stores/useState';

export default defineComponent({
  props:{setValues:Function},
  setup(props){
    const { handleChange, value} = useField(() => '種別コード',undefined);

    const {種別マスタitems, 種別マスタdocs} = useMasters()

    const dialog = ref(null)

    function select(i){
      const 種別マスタitem = 種別マスタitems[i]
      handleChange(種別マスタitem['種別コード'])

      props.setValues({
        容リ法分類:種別マスタitem['初期値_容リ法分類'],
        容リ法商品業種:種別マスタitem['初期値_容リ法商品業種'],
        プラスチックフラグ:種別マスタitem['初期値_プラスチックフラグ'],
        製法コード:種別マスタitem['初期値_製法コード'],

        必要_在庫単位あたり重量:種別マスタitem['必要_在庫単位あたり重量'],
        必要_使用単位あたり重量:種別マスタitem['必要_使用単位あたり重量'],
      })

      dialog.value.close()
    }

    return { value, handleChange, select, 種別マスタitems, useState, 種別マスタdocs, dialog}
  }
})

</script>

<template>
  <div>
    <a  @click="useState().isEdit? dialog.showModal():''" :class="{'!no-underline !text-gray-500':!useState().isEdit}">
      {{ 種別マスタdocs[value]? 種別マスタdocs[value]['種別名']:'選択されていません' }}
    </a>

    <dialog class="modal" ref="dialog">
      <div class="modal-box h-[600px] w-[900px]">
          <h2>種別を選択</h2>

          <ul class="menu cursor-pointer">
            <details>
              <summary class="p-3 text-lg">資材</summary>
              <ul>
                <li v-for=" (種別,i) of 種別マスタitems.slice(0,18)" :key="種別['種別コード']">
                  <a class=" truncate" @click="select(i)">{{種別['種別名']}}</a>
                </li>              
              </ul>
            </details>

            <details>
              <summary class="p-3 text-lg">原料</summary>
              <ul>
                <li v-for=" (種別,i) of 種別マスタitems.slice(19)" :key="種別['種別コード']">
                  <a class=" truncate" @click="select(i+19)">{{種別['種別名']}}</a>
                </li>
              </ul>
            </details>

          </ul>

          <div class=" modal-action">
            <button class="btn" @click="dialog.close()">閉じる</button>
          </div>
      </div>
    </dialog>    
  </div>


</template>