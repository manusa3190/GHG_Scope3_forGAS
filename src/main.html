<!DOCTYPE html>
<html data-theme="cmyk">
  <head>
    <base target="_top">
    <!-- tailwind and daisyui -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.3/dist/full.min.css" rel="stylesheet" type="text/css" />    
    <script src="https://cdn.tailwindcss.com"></script>

    <style type="text/tailwindcss">
      svg {@apply p-1 w-10 mx-2 hover:cursor-pointer hover:bg-gray-200 active:bg-gray-300 self-center rounded-full};
    </style>

    <!--handsontable-->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" />

    <!--gridjs-->
    <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />  

  </head>
  <body>
    <div id='currentUserEmail' class=" hidden"><?= currentUserEmail ?></div>
    <div id="vue-app"></div>

    <!-- vue3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- vue-router -->
    <script src="https://unpkg.com/vue-router@4"></script>
    
    <script>
      const {defineComponent,ref,reactive, computed, onMounted, watch} = Vue
      const { useRoute, useRouter, createRouter, createWebHashHistory} = VueRouter

      const {Grid,html,useSelector} = gridjs

      var 自所属users = []
      const fetch自所属users=()=>new Promise((resolve)=>{
        google.script.run
          .withSuccessHandler(res=>{
            自所属users = res
            resolve()
          })
          .get自所属users()
      })

      var 自所属原資材docs = {}
      const fetch自所属原資材docs=()=>new Promise((resolve)=>{
        const currentUser = 自所属users.find(item=>item['メールアドレス']===currentUserEmail.innerText)
        if(!currentUser)return

        google.script.run
          .withSuccessHandler(res=>{
            自所属原資材docs=res
            resolve()
          })
          .get自所属原資材docs(currentUser['所属名'])
      })

      var 使いまわし情報docs = {}
      const fetch使いまわし情報docs=()=>new Promise((resolve)=>{
        google.script.run
          .withSuccessHandler(res=>{
            使いまわし情報docs=res
            resolve()
          })
          .get使いまわし情報docs()
      })

      var 素材docs = {}
      const fetch素材docs=()=>new Promise((resolve)=>{
        google.script.run
          .withSuccessHandler(res=>{
            素材docs=res
            resolve()
          })
          .get素材docs()
      })

      var マスタitems = {
        品目分類items:[],
        素材items:[],
        成型方法items:[]
      }
      const fetchマスタitems =()=>new Promise((resolve)=>{
        google.script.run
          .withSuccessHandler(res=>{
            const {品目分類items, 素材items, 成型方法items } = res
            マスタitems = {品目分類items, 素材items, 成型方法items }
            resolve()
          })
          .getマスタitems()
      })

      
    </script>

    <?!= include('app') ?>
    <?!= include('components') ?>
    <?!= include('detail') ?>
    <?!= include('index') ?>
    <?!= include('composition') ?>
    <?!= include('assign') ?>

    <script>

      const router = createRouter({
        history: createWebHashHistory(),
        routes:[
          { path: '/', name:'一覧', component: index },
          { path: '/component', name:'構成マスタ管理', component: composition },
          { path: '/assign', name:'記入担当割り振り', component: assign },
        ]
      })

      Vue.createApp({
        components:{app},
        template:`<app />`
        })
        .use(router)
        .mount('#vue-app')
    </script>

  </body>
</html>